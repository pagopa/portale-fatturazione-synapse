{
	"name": "JsonToSAP",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "fat_d_sql",
						"type": "DatasetReference"
					},
					"name": "ReadSqlJson"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "JsonToSapStorage",
						"type": "DatasetReference"
					},
					"name": "ExportJsonToBlobStorage"
				}
			],
			"transformations": [
				{
					"name": "JsonToString",
					"description": "Creates an explicit mapping for each drifted column"
				},
				{
					"name": "ParseToJson"
				}
			],
			"scriptLines": [
				"source(output(",
				"          listaFatture as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     waterMarkColumn: 'Test1',",
				"     isolationLevel: 'NONE',",
				"     query: 'SELECT * FROM pfd.Json4SapAcconto',",
				"     format: 'query',",
				"     mode: 'read') ~> ReadSqlJson",
				"ReadSqlJson derive(listaFatture = toString(listaFatture)) ~> JsonToString",
				"JsonToString parse(listaFatture = listaFatture ? (fattura as (numero as integer,",
				"     dataFattura as string,",
				"     prodotto as string,",
				"     identificativo as string,",
				"     tipologiaFattura as string,",
				"     istitutioID as string,",
				"     onboardingTokenID as string,",
				"     tipoDocumento as string,",
				"     divisa as string,",
				"     metodoPagamento as string,",
				"     causale as string,",
				"     split as boolean,",
				"     sollecito as string,",
				"     datiGeneraliDocumento as (tipologia as string,",
				"     riferimentoNumeroLinea as integer,",
				"     idDocumento as string,",
				"     data as string,",
				"     numItem as string,",
				"     codiceCommessaConvenzione as string,",
				"     CUP as string,",
				"     CIG as string)[],",
				"     posizioni as (numerolinea as string,",
				"     testo as string,",
				"     codiceMateriale as string,",
				"     quantita as integer,",
				"     prezzoUnitario as double,",
				"     imponibile as double)[]))[],",
				"     format: 'json',",
				"     documentForm: 'singleDocument') ~> ParseToJson",
				"ParseToJson sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          numero as integer,",
				"          dataFattura as string,",
				"          prodotto as string,",
				"          identificativo as string,",
				"          tipologiaFattura as string,",
				"          istitutioID as string,",
				"          onboardingTokenID as string,",
				"          tipoDocumento as string,",
				"          divisa as string,",
				"          metodoPagamento as string,",
				"          causale as string,",
				"          split as boolean,",
				"          sollecito as string,",
				"          datiGeneraliDocumento as (tipologia as string, riferimentoNumeroLinea as integer, idDocumento as string, data as string, numItem as string, codiceCommessaConvenzione as string, CUP as string, CIG as string)[],",
				"          posizioni as (numerolinea as integer, testo as string, codiceMateriale as string, quantita as integer, prezzoUnitario as double, imponibile as double)[]",
				"     ),",
				"     partitionFileNames:['FatturePagoPa.json'],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     mapColumn(",
				"          listaFatture",
				"     ),",
				"     partitionBy('hash', 1)) ~> ExportJsonToBlobStorage"
			]
		}
	}
}